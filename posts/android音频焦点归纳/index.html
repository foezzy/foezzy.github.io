<!DOCTYPE html>
<html lang="en-us">
  <head>
    <title>AndroidéŸ³é¢‘ç„¦ç‚¹å½’çº³æ•´ç† | Blog</title>

    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">    
<meta name="viewport" content="width=device-width,minimum-scale=1">
<meta name="description" content="å‰è¨€ ğŸ”—éŸ³é¢‘ç„¦ç‚¹æ˜¯ API 8 ä¸­å¼•å…¥çš„ä¸€ä¸ªæ¦‚å¿µï¼Œå®ƒä¸»è¦ä½œç”¨äºç”¨æˆ·åœ¨åŒä¸€ä¸ªæ—¶åˆ»åªèƒ½å…³æ³¨å•ä¸ªéŸ³é¢‘æµï¼Œæˆ–è€…ç”¨æ¥é™ä½èƒŒæ™¯å£°éŸ³ï¼Œä½¿ç”¨æˆ·åªå…³æ³¨è¦ä¸»è¦çš„å£°éŸ³ã€‚åœ¨ä¸åŒAndroidç‰ˆæœ¬ä¸­ï¼Œå¯¹åº”çš„ä»£ç ä¹Ÿæœ‰åŒºåˆ«ã€‚ä¸»è¦ä¸‰ä¸ªèŠ‚ç‚¹ä¸º
2.2 (API level 8) 5.0 (API level 21) 8.0 (API level 26) 2.2-5.0 ğŸ”—ç”³è¯·ç„¦ç‚¹ï¼š
private void requestAudioFocus() { audioManager = (AudioManager) getContext().getSystemService(Context.AUDIO_SERVICE); if (audioManager != null) { audioManager.requestAudioFocus(mAudioFocusListener, AudioManager.STREAM_MUSIC, AudioManager.AUDIOFOCUS_GAIN_TRANSIENT); } } requestAudioFocusä¸­ï¼Œæœ‰3ä¸ªå‚æ•°ï¼Œå…ˆè¯´å‚æ•°2ï¼Œå‚æ•°2æ˜¯å¤šç§å£°éŸ³ç±»å‹ï¼Œå¦‚ä¸‹ï¼š
AudioManager.STREAM_VOICE_CALL
AudioManager.STREAM_SYSTEM
AudioManager.STREAM_RING
AudioManager.STREAM_MUSIC
AudioManager.STREAM_ALARM
AudioManager.STREAM_NOTIFICATION
AudioManager.STREAM_BLUETOOTH_SCO
AudioManager.STREAM_SYSTEM_ENFORCED
AudioManager.STREAM_DTMF
AudioManager.STREAM_TTS
ç„¶åæ˜¯å‚æ•°3ï¼Œä¹Ÿæ˜¯æœ‰å¤šä¸ªå£°æ˜ç±»å‹ï¼Œå¦‚ä¸‹ï¼š
AudioManager.AUDIOFOCUS_GAINï¼šæƒ³è¦é•¿æœŸå æœ‰ç„¦ç‚¹ï¼Œå¤±å»ç„¦ç‚¹è€…stopæ’­æ”¾å’Œé‡Šæ”¾ AudioManager.AUDIOFOCUS_GAIN_TRANSIENTï¼šæƒ³è¦çŸ­æš‚å æœ‰ç„¦ç‚¹ï¼Œå¤±å»ç„¦ç‚¹è€…pauseæ’­æ”¾ AudioManager.AUDIOFOCUS_GAIN_TRANSIENT_MAY_DUCKï¼šæƒ³è¦çŸ­æš‚å æœ‰ç„¦ç‚¹ï¼Œå¤±å»ç„¦ç‚¹è€…å¯ä»¥ç»§ç»­æ’­æ”¾ä½†æ˜¯éŸ³é‡éœ€è¦è°ƒä½ AudioManager.AUDIOFOCUS_GAIN_TRANSIENT_EXCLUSIVEï¼šæƒ³è¦çŸ­æš‚å æœ‰ç„¦ç‚¹ï¼Œä½†å¸Œæœ›å¤±å»ç„¦ç‚¹è€…ä¸è¦æœ‰å£°éŸ³æ’­æ”¾ æœ€åæ˜¯å‚æ•°1ï¼Œå‚æ•°1è¦è‡ªå·±å†™ä¸ªå›è°ƒï¼š
private AudioManager.OnAudioFocusChangeListener mAudioFocusListener = new AudioManager.OnAudioFocusChangeListener() { @Override public void onAudioFocusChange(int focusChange) { switch (focusChange) { case AudioManager.">
<meta name="generator" content="Hugo 0.121.2">


  <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link rel="stylesheet" href="/css/style.css">



<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />








  </head>

  <body>
    <nav class="navigation">
	
		<a href="/"> <span class="arrow">â†</span>Home</a>
	
	<a href="/posts">Archive</a>
	<a href="/tags">Tags</a>
	<a href="/about">About</a>

	

	
</nav>


    <main class="main">
      

<section id="single">
    <h1 class="title">AndroidéŸ³é¢‘ç„¦ç‚¹å½’çº³æ•´ç†</h1>

    <div class="tip">
        <time datetime="2019-12-14 15:26:42 &#43;0000 UTC">Dec 14, 2019</time>
        <span class="split">
          Â·
        </span>
        <span>
          219 words
        </span>
        <span class="split">
          Â·
        </span>
        <span>
          2 minute read
        </span>
    </div>

    
    


    <div class="content">
      <h2 id="å‰è¨€">å‰è¨€ <a href="#%e5%89%8d%e8%a8%80" class="anchor">ğŸ”—</a></h2><p>éŸ³é¢‘ç„¦ç‚¹æ˜¯ API 8 ä¸­å¼•å…¥çš„ä¸€ä¸ªæ¦‚å¿µï¼Œå®ƒä¸»è¦ä½œç”¨äºç”¨æˆ·åœ¨åŒä¸€ä¸ªæ—¶åˆ»åªèƒ½å…³æ³¨å•ä¸ªéŸ³é¢‘æµï¼Œæˆ–è€…ç”¨æ¥é™ä½èƒŒæ™¯å£°éŸ³ï¼Œä½¿ç”¨æˆ·åªå…³æ³¨è¦ä¸»è¦çš„å£°éŸ³ã€‚åœ¨ä¸åŒAndroidç‰ˆæœ¬ä¸­ï¼Œå¯¹åº”çš„ä»£ç ä¹Ÿæœ‰åŒºåˆ«ã€‚ä¸»è¦ä¸‰ä¸ªèŠ‚ç‚¹ä¸º</p>
<ul>
<li>2.2 (API level 8)</li>
<li>5.0 (API level 21)</li>
<li>8.0 (API level 26)</li>
</ul>
<h2 id="22-50">2.2-5.0 <a href="#22-50" class="anchor">ğŸ”—</a></h2><p>ç”³è¯·ç„¦ç‚¹ï¼š</p>
<pre tabindex="0"><code>private void requestAudioFocus() {
        audioManager = (AudioManager) getContext().getSystemService(Context.AUDIO_SERVICE);
        if (audioManager != null) {
            audioManager.requestAudioFocus(mAudioFocusListener, AudioManager.STREAM_MUSIC, AudioManager.AUDIOFOCUS_GAIN_TRANSIENT);
        }
}
</code></pre><p>requestAudioFocusä¸­ï¼Œæœ‰3ä¸ªå‚æ•°ï¼Œå…ˆè¯´å‚æ•°2ï¼Œå‚æ•°2æ˜¯å¤šç§å£°éŸ³ç±»å‹ï¼Œå¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p>AudioManager.STREAM_VOICE_CALL</p>
</li>
<li>
<p>AudioManager.STREAM_SYSTEM</p>
</li>
<li>
<p>AudioManager.STREAM_RING</p>
</li>
<li>
<p>AudioManager.STREAM_MUSIC</p>
</li>
<li>
<p>AudioManager.STREAM_ALARM</p>
</li>
<li>
<p>AudioManager.STREAM_NOTIFICATION</p>
</li>
<li>
<p>AudioManager.STREAM_BLUETOOTH_SCO</p>
</li>
<li>
<p>AudioManager.STREAM_SYSTEM_ENFORCED</p>
</li>
<li>
<p>AudioManager.STREAM_DTMF</p>
</li>
<li>
<p>AudioManager.STREAM_TTS</p>
</li>
</ul>
<p>ç„¶åæ˜¯å‚æ•°3ï¼Œä¹Ÿæ˜¯æœ‰å¤šä¸ªå£°æ˜ç±»å‹ï¼Œå¦‚ä¸‹ï¼š</p>
<ul>
<li>AudioManager.AUDIOFOCUS_GAINï¼šæƒ³è¦é•¿æœŸå æœ‰ç„¦ç‚¹ï¼Œå¤±å»ç„¦ç‚¹è€…stopæ’­æ”¾å’Œé‡Šæ”¾</li>
<li>AudioManager.AUDIOFOCUS_GAIN_TRANSIENTï¼šæƒ³è¦çŸ­æš‚å æœ‰ç„¦ç‚¹ï¼Œå¤±å»ç„¦ç‚¹è€…pauseæ’­æ”¾</li>
<li>AudioManager.AUDIOFOCUS_GAIN_TRANSIENT_MAY_DUCKï¼šæƒ³è¦çŸ­æš‚å æœ‰ç„¦ç‚¹ï¼Œå¤±å»ç„¦ç‚¹è€…å¯ä»¥ç»§ç»­æ’­æ”¾ä½†æ˜¯éŸ³é‡éœ€è¦è°ƒä½</li>
<li>AudioManager.AUDIOFOCUS_GAIN_TRANSIENT_EXCLUSIVEï¼šæƒ³è¦çŸ­æš‚å æœ‰ç„¦ç‚¹ï¼Œä½†å¸Œæœ›å¤±å»ç„¦ç‚¹è€…ä¸è¦æœ‰å£°éŸ³æ’­æ”¾</li>
</ul>
<p>æœ€åæ˜¯å‚æ•°1ï¼Œå‚æ•°1è¦è‡ªå·±å†™ä¸ªå›è°ƒï¼š</p>
<pre tabindex="0"><code>private AudioManager.OnAudioFocusChangeListener mAudioFocusListener = new AudioManager.OnAudioFocusChangeListener() {
        @Override
        public void onAudioFocusChange(int focusChange) {
            switch (focusChange) {
                case AudioManager.AUDIOFOCUS_LOSS:
                    //å¯¹åº”AUDIOFOCUS_GAIN è¡¨ç¤ºéŸ³é¢‘ç„¦ç‚¹è¯·æ±‚è€…éœ€è¦é•¿æœŸå æœ‰ç„¦ç‚¹ï¼Œè¿™é‡Œä¸€èˆ¬éœ€è¦stopæ’­æ”¾å’Œé‡Šæ”¾
                    // pauseMediaPlayer();
                    break;
                case AudioManager.AUDIOFOCUS_LOSS_TRANSIENT:
                    //å¯¹åº”AUDIOFOCUS_GAIN_TRANSIENT è¡¨ç¤ºéŸ³é¢‘ç„¦ç‚¹è¯·æ±‚è€…éœ€è¦çŸ­æš‚å æœ‰ç„¦ç‚¹ï¼Œè¿™é‡Œä¸€èˆ¬éœ€è¦pauseæ’­æ”¾
                    //pauseMediaPlayer();
                    break;
                case AudioManager.AUDIOFOCUS_LOSS_TRANSIENT_CAN_DUCK:
                    //å¯¹åº”AUDIOFOCUS_GAIN_TRANSIENT_MAY_DUCK è¡¨ç¤ºéŸ³é¢‘ç„¦ç‚¹è¯·æ±‚è€…éœ€è¦å æœ‰ç„¦ç‚¹ï¼Œä½†æ˜¯æˆ‘ä¹Ÿå¯ä»¥ç»§ç»­æ’­æ”¾ï¼Œåªæ˜¯éœ€è¦é™ä½éŸ³é‡æˆ–éŸ³é‡ç½®ä¸º0
                    break;
                case AudioManager.AUDIOFOCUS_GAIN:
                    //è·å¾—ç„¦ç‚¹ï¼Œè¿™é‡Œå¯ä»¥è¿›è¡Œæ¢å¤æ’­æ”¾
                    if (mediaPlayer != null) {
                       //  startMediaPlayer();
                    }
                    break;
                default:
            }
        }
    };
</code></pre><p>ä¸¢å¼ƒç„¦ç‚¹ï¼š</p>
<pre tabindex="0"><code>private void abandonAudioFocus() {
        audioManager = (AudioManager) getContext().getSystemService(Context.AUDIO_SERVICE);
        if (audioManager != null) {
            audioManager.abandonAudioFocus(mAudioFocusListener);
        }
    }
</code></pre><h2 id="äºŒçº§æ ‡é¢˜-50">äºŒçº§æ ‡é¢˜ 5.0 <a href="#%e4%ba%8c%e7%ba%a7%e6%a0%87%e9%a2%98-50" class="anchor">ğŸ”—</a></h2><p>å¯¹äº Android 5.0 (API level 21) æˆ–æ›´é«˜ç‰ˆæœ¬çš„åº”ç”¨ç¨‹åºï¼ŒéŸ³é¢‘åº”ç”¨ç¨‹åºåº”è¯¥ä½¿ç”¨ AudioAttributes æ¥æè¿°ä½ çš„åº”ç”¨ç¨‹åºæ­£åœ¨æ’­æ”¾çš„éŸ³é¢‘ç±»å‹ã€‚ä¾‹å¦‚ï¼Œæ’­æ”¾è¯­éŸ³çš„åº”ç”¨ç¨‹åºåº”è¯¥æŒ‡å®š CONTENT_TYPE_SPEECHï¼Œå…¶å®å°±æ˜¯éœ€è¦åŠ ä¸ªå£°æ˜ï¼Œç”³è¯·ç„¦ç‚¹çš„æ–¹å¼è¿˜æ˜¯æ²¡å˜ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">preparePlayer</span>(File audioFile, <span style="color:#66d9ef">boolean</span> frontSpeaker) <span style="color:#66d9ef">throws</span> IOException {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (mPlayer <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>        mPlayer <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> MediaPlayer();
</span></span><span style="display:flex;"><span>        mPlayer.<span style="color:#a6e22e">setOnCompletionListener</span>(<span style="color:#66d9ef">this</span>);
</span></span><span style="display:flex;"><span>        mPlayer.<span style="color:#a6e22e">setOnErrorListener</span>(<span style="color:#66d9ef">this</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//5.0è¦setAudioAttributes</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (Build.<span style="color:#a6e22e">VERSION</span>.<span style="color:#a6e22e">SDK_INT</span> <span style="color:#f92672">&gt;=</span> Build.<span style="color:#a6e22e">VERSION_CODES</span>.<span style="color:#a6e22e">LOLLIPOP</span>) {
</span></span><span style="display:flex;"><span>        mPlayer.<span style="color:#a6e22e">setAudioAttributes</span>(<span style="color:#66d9ef">new</span> AudioAttributes.<span style="color:#a6e22e">Builder</span>()
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">setContentType</span>(frontSpeaker <span style="color:#f92672">?</span> AudioAttributes.<span style="color:#a6e22e">CONTENT_TYPE_SPEECH</span> :
</span></span><span style="display:flex;"><span>                AudioAttributes.<span style="color:#a6e22e">CONTENT_TYPE_MUSIC</span>)
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">setUsage</span>(frontSpeaker <span style="color:#f92672">?</span> AudioAttributes.<span style="color:#a6e22e">USAGE_VOICE_COMMUNICATION</span> :
</span></span><span style="display:flex;"><span>                AudioAttributes.<span style="color:#a6e22e">USAGE_MEDIA</span>)
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">build</span>());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        mPlayer.<span style="color:#a6e22e">setAudioStreamType</span>(frontSpeaker <span style="color:#f92672">?</span> AudioManager.<span style="color:#a6e22e">STREAM_VOICE_CALL</span> :
</span></span><span style="display:flex;"><span>            AudioManager.<span style="color:#a6e22e">STREAM_MUSIC</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    mPlayer.<span style="color:#a6e22e">setDataSource</span>(audioFile.<span style="color:#a6e22e">getAbsolutePath</span>());
</span></span><span style="display:flex;"><span>    mPlayer.<span style="color:#a6e22e">prepare</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="80">8.0 <a href="#80" class="anchor">ğŸ”—</a></h2><p>å’Œä¹‹å‰ä¸€æ ·ï¼ŒAndroid8.0ä¸­ä¹Ÿä½¿ç”¨äº†requestAudioFocus()æ¥è¯·æ±‚éŸ³é¢‘ç„¦ç‚¹ï¼Œä¸ä¸€æ ·çš„æ˜¯ï¼Œä½¿ç”¨abandonAudioFocusRequest()é‡Šæ”¾éŸ³é¢‘ç„¦ç‚¹ï¼Œå¹¶ä¸”è¯·æ±‚å’Œé‡Šæ”¾éƒ½éœ€è¦ä¼ å…¥åŒä¸€ä¸ªAudioFocusRequestå®ä¾‹ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>mAudioFocusRequest <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> AudioFocusRequest.<span style="color:#a6e22e">Builder</span>(AudioManager.<span style="color:#a6e22e">AUDIOFOCUS_GAIN</span>)
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">setAudioAttributes</span>(<span style="color:#66d9ef">new</span> AudioAttributes.<span style="color:#a6e22e">Builder</span>()
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">setUsage</span>(AudioAttributes.<span style="color:#a6e22e">USAGE_MEDIA</span>)
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">setContentType</span>(AudioAttributes.<span style="color:#a6e22e">CONTENT_TYPE_MOVIE</span>)
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">build</span>())
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">setAcceptsDelayedFocusGain</span>(<span style="color:#66d9ef">true</span>)
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">setOnAudioFocusChangeListener</span>(mAudioFocusChangeListener)
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">build</span>();
</span></span><span style="display:flex;"><span><span style="color:#75715e">//è¯·æ±‚éŸ³é¢‘ç„¦ç‚¹      </span>
</span></span><span style="display:flex;"><span>requestFocusResult <span style="color:#f92672">=</span> mAudioManager.<span style="color:#a6e22e">requestAudioFocus</span>(mAudioFocusRequest);
</span></span><span style="display:flex;"><span><span style="color:#75715e">//é‡Šæ”¾éŸ³é¢‘ç„¦ç‚¹</span>
</span></span><span style="display:flex;"><span>abandonFocusResult <span style="color:#f92672">=</span> mAudioManager.<span style="color:#a6e22e">abandonAudioFocusRequest</span>(mAudioFocusRequest);
</span></span></code></pre></div><h2 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥ <a href="#%e5%8f%82%e8%80%83%e9%93%be%e6%8e%a5" class="anchor">ğŸ”—</a></h2><ul>
<li>
<p><!-- raw HTML omitted --><a href="https://blog.csdn.net/u014296677/article/details/79643380" target="_blank" rel="noopener">Android éŸ³é¢‘ç„¦ç‚¹ AudioFocus åˆ†æ</a><!-- raw HTML omitted --></p>
</li>
<li>
<p><!-- raw HTML omitted --><a href="https://blog.csdn.net/jacksinrow/article/details/84139585" target="_blank" rel="noopener">Android éŸ³é¢‘ç„¦ç‚¹ AudioFocus ä»‹ç»å’Œä½¿ç”¨</a><!-- raw HTML omitted --></p>
</li>
<li>
<p><!-- raw HTML omitted --><a href="https://juejin.im/post/5bda9c15f265da395a1dd57c" target="_blank" rel="noopener">androidéŸ³è§†é¢‘æŒ‡å—-ç®¡ç†éŸ³é¢‘ç„¦ç‚¹</a><!-- raw HTML omitted --></p>
</li>
<li>
<p><!-- raw HTML omitted --><a href="https://haohaozaici.github.io/2018/04/24/Android%20Sound%20overlap/index.html" target="_blank" rel="noopener">ã€Œæ’­æ”¾å™¨ã€AndroidéŸ³é¢‘ç„¦ç‚¹</a><!-- raw HTML omitted --></p>
</li>
</ul>

    </div>

    
        <div class="tags">
            
                <a href="https://foezzy.github.io/tags/android">Android</a>
            
                <a href="https://foezzy.github.io/tags/%E9%9F%B3%E9%A2%91%E7%84%A6%E7%82%B9">éŸ³é¢‘ç„¦ç‚¹</a>
            
        </div>
    
    
    

</section>


    </main>
    
    <footer id="footer">
    

    <div class="copyright">
    
       Â© Copyright 
       2024 
       <span class="split">
        <svg fill="#bbbbbb" width="15" height="15" version="1.1" id="heart-15" xmlns="http://www.w3.org/2000/svg" width="15px" height="15px" viewBox="0 0 15 15">
  <path d="M13.91,6.75c-1.17,2.25-4.3,5.31-6.07,6.94c-0.1903,0.1718-0.4797,0.1718-0.67,0C5.39,12.06,2.26,9,1.09,6.75&#xA;&#x9;C-1.48,1.8,5-1.5,7.5,3.45C10-1.5,16.48,1.8,13.91,6.75z"/>
</svg>
       </span>
       
    
    </div>

    
      <div class="powerby">
        Powered by <a href='http://www.gohugo.io/'>Hugo</a> Theme By <a href='https://github.com/nodejh/hugo-theme-mini'>nodejh</a>
      </div>
    
</footer>



  </body>
</html>
