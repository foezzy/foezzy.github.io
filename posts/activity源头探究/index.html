<!doctype html><html lang=en-us><head><title>Activityæºå¤´æ¢ç©¶ | Blog</title>
<meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="ç–‘é—® ğŸ”— å¼€å‘ä¸­é€šè¿‡ startActivity() åˆ›å»º Activity å¯¹è±¡åˆ°åº•è¢«è°æŒæœ‰å¼•ç”¨äº†ï¼Ÿ æ–°å¯åŠ¨çš„ Activity å¯¹è±¡åœ¨å…¶ç”Ÿå‘½å‘¨æœŸä¸­ç†åº”æ˜¯ä¸€ç›´è¢«æŒæœ‰å¼•ç”¨ï¼Œä¸ç„¶ç³»ç»Ÿ gc çš„æ—¶å€™å°±ä¼šè¢«å›æ”¶æ‰ï¼Œé‚£ä¹ˆå…¶ä¸­çš„å¼•ç”¨å…³ç³»æ˜¯æ€æ ·çš„å‘¢ï¼Ÿ Activity å¯¹è±¡çš„åˆ›å»º ğŸ”—Activity çš„åˆ›å»ºä¼šå›è°ƒåˆ° ActivityThread ä¸­çš„ handleLaunchActivity() æ–¹æ³•ï¼š
frameworks/base/core/java/android/app/ActivityThread.java:
@Override public Activity handleLaunchActivity(ActivityClientRecord r, PendingTransactionActions pendingActions, Intent customIntent){ Â·Â·Â· final Activity a = performLaunchActivity(r, customIntent); Â·Â·Â· return a; } æ¥ç€åœ¨ performLaunchActivity() æ–¹æ³•é‡Œæ‰¾åˆ°äº† Acitivity å®ä¾‹çš„åˆ›å»ºï¼š
private Activity performLaunchActivity(ActivityClientRecord r, Intent customIntent) { Â·Â·Â· ContextImpl appContext = createBaseContextForActivity(r); Activity activity = null; try { // æ³¨è§£1ï¼šé€šè¿‡ ClassLoader ä»¥åŠç›®æ ‡ Activity çš„ç±»åæ¥åˆ›å»ºæ–°çš„ Activity å®ä¾‹ java."><meta name=generator content="Hugo 0.124.1"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/images/favicon.ico type=image/x-icon></head><body><nav class=navigation><a href=/><span class=arrow>â†</span>Home</a>
<a href=/posts>Archive</a>
<a href=/tags>Tags</a>
<a href=/about>About</a></nav><main class=main><section id=single><h1 class=title>Activityæºå¤´æ¢ç©¶</h1><div class=tip><time datetime="0001-01-01 00:00:00 +0000 UTC">Jan 1, 0001</time>
<span class=split>Â·
</span><span>147 words
</span><span class=split>Â·
</span><span>1 minute read</span></div><div class=content><h2 id=ç–‘é—®>ç–‘é—® <a href=#%e7%96%91%e9%97%ae class=anchor>ğŸ”—</a></h2><ul><li>å¼€å‘ä¸­é€šè¿‡ startActivity() åˆ›å»º Activity å¯¹è±¡åˆ°åº•è¢«è°æŒæœ‰å¼•ç”¨äº†ï¼Ÿ</li><li>æ–°å¯åŠ¨çš„ Activity å¯¹è±¡åœ¨å…¶ç”Ÿå‘½å‘¨æœŸä¸­ç†åº”æ˜¯ä¸€ç›´è¢«æŒæœ‰å¼•ç”¨ï¼Œä¸ç„¶ç³»ç»Ÿ gc çš„æ—¶å€™å°±ä¼šè¢«å›æ”¶æ‰ï¼Œé‚£ä¹ˆå…¶ä¸­çš„å¼•ç”¨å…³ç³»æ˜¯æ€æ ·çš„å‘¢ï¼Ÿ</li></ul><h2 id=activity-å¯¹è±¡çš„åˆ›å»º>Activity å¯¹è±¡çš„åˆ›å»º <a href=#activity-%e5%af%b9%e8%b1%a1%e7%9a%84%e5%88%9b%e5%bb%ba class=anchor>ğŸ”—</a></h2><p>Activity çš„åˆ›å»ºä¼šå›è°ƒåˆ° ActivityThread ä¸­çš„ handleLaunchActivity() æ–¹æ³•ï¼š</p><blockquote><p>frameworks/base/core/java/android/app/ActivityThread.java:</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> Activity <span style=color:#a6e22e>handleLaunchActivity</span>(ActivityClientRecord r,
</span></span><span style=display:flex><span>      PendingTransactionActions pendingActions, Intent customIntent){
</span></span><span style=display:flex><span>      <span style=color:#960050;background-color:#1e0010>Â·Â·Â·</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>final</span> Activity a <span style=color:#f92672>=</span> performLaunchActivity(r, customIntent);
</span></span><span style=display:flex><span>      <span style=color:#960050;background-color:#1e0010>Â·Â·Â·</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> a;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>æ¥ç€åœ¨ performLaunchActivity() æ–¹æ³•é‡Œæ‰¾åˆ°äº† Acitivity å®ä¾‹çš„åˆ›å»ºï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>private</span> Activity <span style=color:#a6e22e>performLaunchActivity</span>(ActivityClientRecord r, Intent customIntent) {
</span></span><span style=display:flex><span>    <span style=color:#960050;background-color:#1e0010>Â·Â·Â·</span>
</span></span><span style=display:flex><span>    ContextImpl appContext <span style=color:#f92672>=</span> createBaseContextForActivity(r);
</span></span><span style=display:flex><span>    Activity activity <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>      <span style=color:#75715e>// æ³¨è§£1ï¼šé€šè¿‡ ClassLoader ä»¥åŠç›®æ ‡ Activity çš„ç±»åæ¥åˆ›å»ºæ–°çš„ Activity å®ä¾‹</span>
</span></span><span style=display:flex><span>        java.<span style=color:#a6e22e>lang</span>.<span style=color:#a6e22e>ClassLoader</span> cl <span style=color:#f92672>=</span> appContext.<span style=color:#a6e22e>getClassLoader</span>();
</span></span><span style=display:flex><span>        activity <span style=color:#f92672>=</span> mInstrumentation.<span style=color:#a6e22e>newActivity</span>(
</span></span><span style=display:flex><span>                 cl, component.<span style=color:#a6e22e>getClassName</span>(), r.<span style=color:#a6e22e>intent</span>);
</span></span><span style=display:flex><span>        <span style=color:#960050;background-color:#1e0010>Â·Â·Â·</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#960050;background-color:#1e0010>Â·Â·Â·</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Activity ç›¸å…³çš„åˆ›å»ºå·¥ä½œäº¤ç”±ç»™äº† Instrumentation ç±»å¤„ç†ï¼š</p><blockquote><p>frameworks/base/core/java/android/app/Instrumentation.java:</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> Activity <span style=color:#a6e22e>newActivity</span>(ClassLoader cl, String className,Intent intent)
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>throws</span> InstantiationException, IllegalAccessException,
</span></span><span style=display:flex><span>      ClassNotFoundException {
</span></span><span style=display:flex><span>      String pkg <span style=color:#f92672>=</span> intent <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>&amp;&amp;</span> intent.<span style=color:#a6e22e>getComponent</span>() <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>                  <span style=color:#f92672>?</span> intent.<span style=color:#a6e22e>getComponent</span>().<span style=color:#a6e22e>getPackageName</span>() : <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> getFactory(pkg).<span style=color:#a6e22e>instantiateActivity</span>(cl, className, intent);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>æœ€ç»ˆçš„åˆ›å»ºå·¥ä½œç”±è¿›ä¸€æ­¥äº¤ç”±å·¥å‚ç±» AppComponentFactory å®ç°ï¼š</p><blockquote><p>frameworks/base/core/java/android/app/AppComponentFactory.java:</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#a6e22e>@NonNull</span> Activity <span style=color:#a6e22e>instantiateActivity</span>(<span style=color:#a6e22e>@NonNull</span> ClassLoader cl, 
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NonNull</span> String className,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Nullable</span> Intent intent)<span style=color:#66d9ef>throws</span> InstantiationException, 
</span></span><span style=display:flex><span>    IllegalAccessException, ClassNotFoundException {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> (Activity) cl.<span style=color:#a6e22e>loadClass</span>(className).<span style=color:#a6e22e>newInstance</span>();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è‡³æ­¤å°±å®Œæˆäº†Activityçš„åˆ›å»º</p></div><div class=tags><a href=https://foezzy.github.io/tags/activity%E6%BA%90%E5%A4%B4>Activityæºå¤´</a></div></section></main><footer id=footer><div class=copyright>Â© Copyright
2024
<span class=split><svg fill="#bbb" width="15" height="15" id="heart-15" xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 15 15"><path d="M13.91 6.75c-1.17 2.25-4.3 5.31-6.07 6.94-.1903.1718-.4797.1718-.67.0C5.39 12.06 2.26 9 1.09 6.75-1.48 1.8 5-1.5 7.5 3.45 10-1.5 16.48 1.8 13.91 6.75z"/></svg></span></div><div class=powerby>Powered by <a href=http://www.gohugo.io/>Hugo</a> Theme By <a href=https://github.com/nodejh/hugo-theme-mini>nodejh</a></div></footer></body></html>