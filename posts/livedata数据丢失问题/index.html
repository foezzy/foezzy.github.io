<!doctype html><html lang=en-us><head><title>LiveDataæ•°æ®ä¸¢å¤±é—®é¢˜ | Blog</title>
<meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content='LiveDataä¸€ä¸ªå…·æœ‰ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥èƒ½åŠ›çš„è§‚å¯Ÿè€…æ¨¡å¼ï¼Œæ˜¯åœ¨é¡µé¢ä¸æ•°æ®åˆ†ç¦»ä¸­ç»´æŒé¡µé¢å’Œæ•°æ®çš„ä¸€è‡´æ€§çš„æ¡¥æ¢ã€‚
åŸºæœ¬ä½¿ç”¨ ğŸ”—ä¸€èˆ¬åœ¨ViewModelä¸­å®šä¹‰
val uiStatusLiveData = MutableLiveData<LoginUiStatus>() åœ¨éœ€è¦é€šçŸ¥é¡µé¢çš„æ•°æ®å˜åŒ–çš„æ—¶å€™ï¼Œå°†æ¶ˆæ¯å‘å¸ƒ
val status = LoginUiStatus() status.needDismissDialog = true uiStatusLiveData.postValue(status) åœ¨activityæˆ–è€…fragmentä¸­åªè¦æ³¨å†Œè§‚å¯Ÿç€å°±å¥½äº†
viewModel.uiStatusLiveData.observe(this) { status -> //æ›´æ”¹UIçš„ä»£ç  } ä»¥ä¸Šå°±æ˜¯ç®€å•çš„ä½¿ç”¨ï¼Œç„¶è€Œåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å‡ºç°äº†ä¸€ä¸ªé—®é¢˜ï¼šå‘é€æ•°æ®ä¸¢å¤±ã€‚
æ•°æ®ä¸¢å¤±é—®é¢˜ ğŸ”—äº‹æƒ…çš„èµ·å› æ˜¯è¿™æ ·çš„ï¼Œæˆ‘åœ¨viewmodelä¸­å‘¨æœŸæ€§çš„å‘ä¸€ä¸ªæ¶ˆæ¯å»é€šçŸ¥UIæ”¹å˜ï¼Œåœ¨å‘¨æœŸä¹‹å¤–ï¼Œè¿˜å‘äº†å…¶ä»–çš„æ¶ˆæ¯ã€‚å¯æ˜¯æœ‰æ—¶å€™å´æ”¶ä¸åˆ°å‘¨æœŸä¹‹å¤–çš„æ¶ˆæ¯ã€‚äºæ˜¯å»æŸ¥æºç çœ‹çœ‹é—®é¢˜å‡ºåœ¨äº†å“ªã€‚
protected void postValue(T value) { boolean postTask; synchronized (mDataLock) { postTask = mPendingData == NOT_SET; mPendingData = value; } if (!postTask) { return; } ArchTaskExecutor.getInstance().postToMainThread(mPostValueRunnable); } è¿™ä»£ç å°±æœ‰æ„æ€äº†ï¼Œå¦‚æœä¸€æ¬¡å‘é€å¾ˆå¤šï¼ŒLiveDataæ¥ä¸åŠå‘é€çš„è¯ï¼Œä»–å°±ä¼šä¸¢å¼ƒæœ€æ—©è·å–çš„è€Œåªå‘é€æœ€åä¸€ä¸ªæ¶ˆæ¯ã€‚å¦‚æœä¸€æ¬¡å‘é€æ¶ˆæ¯å¤ªå¤šçš„æ—¶å€™ï¼Œé‡è¦çš„ä¸­é—´æ€æ¶ˆæ¯ä¼šè¢«ä¸¢å¼ƒã€‚
é‚£ä¹ˆå‘é€æ¶ˆæ¯è¿˜æœ‰å¦ä¸€ä¸ªæ–¹æ³•å³setValue()
@MainThread protected void setValue(T value) { assertMainThread("setValue"); mVersion++; mData = value; dispatchingValue(null); } è¿™ä¸ªæ–¹æ³•ä¸ä¼šä¸¢å¤±æ¶ˆæ¯ï¼Œä½†æ˜¯åªèƒ½åœ¨ä¸»çº¿ç¨‹ä¸­ä½¿ç”¨
æ€»ç»“ ğŸ”—setValueæ–¹æ³•ï¼Œä¸ä¼šä¸¢å¤±æ¶ˆæ¯ï¼Œä½†æ˜¯å¿…é¡»åœ¨ä¸»çº¿ç¨‹ä¸­ä½¿ç”¨'><meta name=generator content="Hugo 0.124.1"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/images/favicon.ico type=image/x-icon></head><body><nav class=navigation><a href=/><span class=arrow>â†</span>Home</a>
<a href=/posts>Archive</a>
<a href=/tags>Tags</a>
<a href=/about>About</a></nav><main class=main><section id=single><h1 class=title>LiveDataæ•°æ®ä¸¢å¤±é—®é¢˜</h1><div class=tip><time datetime="2023-11-12 19:45:20 +0000 UTC">Nov 12, 2023</time>
<span class=split>Â·
</span><span>71 words
</span><span class=split>Â·
</span><span>1 minute read</span></div><div class=content><p>LiveDataä¸€ä¸ªå…·æœ‰ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥èƒ½åŠ›çš„è§‚å¯Ÿè€…æ¨¡å¼ï¼Œæ˜¯åœ¨é¡µé¢ä¸æ•°æ®åˆ†ç¦»ä¸­ç»´æŒé¡µé¢å’Œæ•°æ®çš„ä¸€è‡´æ€§çš„æ¡¥æ¢ã€‚</p><h2 id=åŸºæœ¬ä½¿ç”¨>åŸºæœ¬ä½¿ç”¨ <a href=#%e5%9f%ba%e6%9c%ac%e4%bd%bf%e7%94%a8 class=anchor>ğŸ”—</a></h2><p>ä¸€èˆ¬åœ¨ViewModelä¸­å®šä¹‰</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>val</span> uiStatusLiveData = MutableLiveData&lt;LoginUiStatus&gt;()
</span></span></code></pre></div><p>åœ¨éœ€è¦é€šçŸ¥é¡µé¢çš„æ•°æ®å˜åŒ–çš„æ—¶å€™ï¼Œå°†æ¶ˆæ¯å‘å¸ƒ</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>val</span> status = LoginUiStatus()  
</span></span><span style=display:flex><span>status.needDismissDialog = <span style=color:#66d9ef>true</span>  
</span></span><span style=display:flex><span>uiStatusLiveData.postValue(status)
</span></span></code></pre></div><p>åœ¨activityæˆ–è€…fragmentä¸­åªè¦æ³¨å†Œè§‚å¯Ÿç€å°±å¥½äº†</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>viewModel.uiStatusLiveData.observe(<span style=color:#66d9ef>this</span>) { status <span style=color:#f92672>-&gt;</span>  
</span></span><span style=display:flex><span>   <span style=color:#75715e>//æ›´æ”¹UIçš„ä»£ç 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>} 
</span></span></code></pre></div><p>ä»¥ä¸Šå°±æ˜¯ç®€å•çš„ä½¿ç”¨ï¼Œç„¶è€Œåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å‡ºç°äº†ä¸€ä¸ªé—®é¢˜ï¼šå‘é€æ•°æ®ä¸¢å¤±ã€‚</p><h2 id=æ•°æ®ä¸¢å¤±é—®é¢˜>æ•°æ®ä¸¢å¤±é—®é¢˜ <a href=#%e6%95%b0%e6%8d%ae%e4%b8%a2%e5%a4%b1%e9%97%ae%e9%a2%98 class=anchor>ğŸ”—</a></h2><p>äº‹æƒ…çš„èµ·å› æ˜¯è¿™æ ·çš„ï¼Œæˆ‘åœ¨viewmodelä¸­å‘¨æœŸæ€§çš„å‘ä¸€ä¸ªæ¶ˆæ¯å»é€šçŸ¥UIæ”¹å˜ï¼Œåœ¨å‘¨æœŸä¹‹å¤–ï¼Œè¿˜å‘äº†å…¶ä»–çš„æ¶ˆæ¯ã€‚å¯æ˜¯æœ‰æ—¶å€™å´æ”¶ä¸åˆ°å‘¨æœŸä¹‹å¤–çš„æ¶ˆæ¯ã€‚äºæ˜¯å»æŸ¥æºç çœ‹çœ‹é—®é¢˜å‡ºåœ¨äº†å“ªã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>protected</span> void postValue(T <span style=color:#66d9ef>value</span>) {  
</span></span><span style=display:flex><span>    boolean postTask;  
</span></span><span style=display:flex><span>    synchronized (mDataLock) {  
</span></span><span style=display:flex><span>        postTask = mPendingData <span style=color:#f92672>==</span> NOT_SET;  
</span></span><span style=display:flex><span>        mPendingData = <span style=color:#66d9ef>value</span>;  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (!postTask) {  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span>;  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ArchTaskExecutor</span>.getInstance().postToMainThread(mPostValueRunnable);  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿™ä»£ç å°±æœ‰æ„æ€äº†ï¼Œå¦‚æœä¸€æ¬¡å‘é€å¾ˆå¤šï¼ŒLiveDataæ¥ä¸åŠå‘é€çš„è¯ï¼Œä»–å°±ä¼šä¸¢å¼ƒæœ€æ—©è·å–çš„è€Œåªå‘é€æœ€åä¸€ä¸ªæ¶ˆæ¯ã€‚å¦‚æœä¸€æ¬¡å‘é€æ¶ˆæ¯å¤ªå¤šçš„æ—¶å€™ï¼Œé‡è¦çš„ä¸­é—´æ€æ¶ˆæ¯ä¼šè¢«ä¸¢å¼ƒã€‚</p><p>é‚£ä¹ˆå‘é€æ¶ˆæ¯è¿˜æœ‰å¦ä¸€ä¸ªæ–¹æ³•å³setValue()</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#a6e22e>@MainThread</span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>protected</span> void setValue(T <span style=color:#66d9ef>value</span>) {  
</span></span><span style=display:flex><span>  assertMainThread(<span style=color:#e6db74>&#34;setValue&#34;</span>);  
</span></span><span style=display:flex><span>  mVersion<span style=color:#f92672>++</span>;  
</span></span><span style=display:flex><span>  mData = <span style=color:#66d9ef>value</span>;  
</span></span><span style=display:flex><span>  dispatchingValue(<span style=color:#66d9ef>null</span>);  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿™ä¸ªæ–¹æ³•ä¸ä¼šä¸¢å¤±æ¶ˆæ¯ï¼Œä½†æ˜¯åªèƒ½åœ¨ä¸»çº¿ç¨‹ä¸­ä½¿ç”¨</p><h2 id=æ€»ç»“>æ€»ç»“ <a href=#%e6%80%bb%e7%bb%93 class=anchor>ğŸ”—</a></h2><p>setValueæ–¹æ³•ï¼Œä¸ä¼šä¸¢å¤±æ¶ˆæ¯ï¼Œä½†æ˜¯å¿…é¡»åœ¨ä¸»çº¿ç¨‹ä¸­ä½¿ç”¨</p><p>postValueæ–¹æ³•ï¼Œä¼šä¸¢å¤±æ¶ˆæ¯ï¼Œå¯ä»¥åœ¨å­çº¿ç¨‹ä¸­ä½¿ç”¨</p></div><div class=tags><a href=https://foezzy.github.io/tags/livedata>LiveData</a></div></section></main><footer id=footer><div class=copyright>Â© Copyright
2024
<span class=split><svg fill="#bbb" width="15" height="15" id="heart-15" xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 15 15"><path d="M13.91 6.75c-1.17 2.25-4.3 5.31-6.07 6.94-.1903.1718-.4797.1718-.67.0C5.39 12.06 2.26 9 1.09 6.75-1.48 1.8 5-1.5 7.5 3.45 10-1.5 16.48 1.8 13.91 6.75z"/></svg></span></div><div class=powerby>Powered by <a href=http://www.gohugo.io/>Hugo</a> Theme By <a href=https://github.com/nodejh/hugo-theme-mini>nodejh</a></div></footer></body></html>