<!doctype html><html lang=en-us><head><title>Glide用到的代码记录 | Blog</title>
<meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content='同步加载 🔗public static void loadImgSync(Context context, String url) { new Thread(new Runnable() { @Override public void run() { FutureTarget<Bitmap> futureBitmap = Glide.with(context) .asBitmap() .load(url) .submit(); try { Bitmap myBitmap = futureBitmap.get(); LogUtils.d("hei:" + myBitmap.getHeight()); LogUtils.d("wid:" + myBitmap.getWidth()); } catch (ExecutionException e) { e.printStackTrace(); } catch (InterruptedException e) { e.printStackTrace(); } } }).start(); } 获取宽高 🔗方式1： 🔗Glide.with(getContext().getApplicationContext()) .asBitmap() .load(path) .into(new SimpleTarget<Bitmap>() { @Override public void onResourceReady(Bitmap bitmap, Transition<? super Bitmap> transition) { int w = bitmap.'><meta name=generator content="Hugo 0.124.1"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/images/favicon.ico type=image/x-icon></head><body><nav class=navigation><a href=/><span class=arrow>←</span>Home</a>
<a href=/posts>Archive</a>
<a href=/tags>Tags</a>
<a href=/about>About</a></nav><main class=main><section id=single><h1 class=title>Glide用到的代码记录</h1><div class=tip><time datetime="2020-05-12 10:32:00 +0000 UTC">May 12, 2020</time>
<span class=split>·
</span><span>344 words
</span><span class=split>·
</span><span>2 minute read</span></div><div class=content><h3 id=同步加载>同步加载 <a href=#%e5%90%8c%e6%ad%a5%e5%8a%a0%e8%bd%bd class=anchor>🔗</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>loadImgSync</span>(Context context, String url) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>new</span> Thread(<span style=color:#66d9ef>new</span> Runnable() {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>run</span>() {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                FutureTarget<span style=color:#f92672>&lt;</span>Bitmap<span style=color:#f92672>&gt;</span> futureBitmap <span style=color:#f92672>=</span> Glide.<span style=color:#a6e22e>with</span>(context)
</span></span><span style=display:flex><span>                        .<span style=color:#a6e22e>asBitmap</span>()
</span></span><span style=display:flex><span>                        .<span style=color:#a6e22e>load</span>(url)
</span></span><span style=display:flex><span>                        .<span style=color:#a6e22e>submit</span>();
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>                    Bitmap myBitmap <span style=color:#f92672>=</span> futureBitmap.<span style=color:#a6e22e>get</span>();
</span></span><span style=display:flex><span>                    LogUtils.<span style=color:#a6e22e>d</span>(<span style=color:#e6db74>&#34;hei:&#34;</span> <span style=color:#f92672>+</span> myBitmap.<span style=color:#a6e22e>getHeight</span>());
</span></span><span style=display:flex><span>                    LogUtils.<span style=color:#a6e22e>d</span>(<span style=color:#e6db74>&#34;wid:&#34;</span> <span style=color:#f92672>+</span> myBitmap.<span style=color:#a6e22e>getWidth</span>());
</span></span><span style=display:flex><span>                } <span style=color:#66d9ef>catch</span> (ExecutionException e) {
</span></span><span style=display:flex><span>                    e.<span style=color:#a6e22e>printStackTrace</span>();
</span></span><span style=display:flex><span>                } <span style=color:#66d9ef>catch</span> (InterruptedException e) {
</span></span><span style=display:flex><span>                    e.<span style=color:#a6e22e>printStackTrace</span>();
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }).<span style=color:#a6e22e>start</span>();
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><h3 id=获取宽高>获取宽高 <a href=#%e8%8e%b7%e5%8f%96%e5%ae%bd%e9%ab%98 class=anchor>🔗</a></h3><h4 id=方式1>方式1： <a href=#%e6%96%b9%e5%bc%8f1 class=anchor>🔗</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>Glide.<span style=color:#a6e22e>with</span>(getContext().<span style=color:#a6e22e>getApplicationContext</span>())
</span></span><span style=display:flex><span>     .<span style=color:#a6e22e>asBitmap</span>()
</span></span><span style=display:flex><span>     .<span style=color:#a6e22e>load</span>(path)
</span></span><span style=display:flex><span>     .<span style=color:#a6e22e>into</span>(<span style=color:#66d9ef>new</span> SimpleTarget<span style=color:#f92672>&lt;</span>Bitmap<span style=color:#f92672>&gt;</span>() {
</span></span><span style=display:flex><span>         <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onResourceReady</span>(Bitmap bitmap,
</span></span><span style=display:flex><span>                                     Transition<span style=color:#f92672>&lt;?</span> <span style=color:#66d9ef>super</span> Bitmap<span style=color:#f92672>&gt;</span> transition) {
</span></span><span style=display:flex><span>                                     
</span></span><span style=display:flex><span>             <span style=color:#66d9ef>int</span> w <span style=color:#f92672>=</span> bitmap.<span style=color:#a6e22e>getWidth</span>();
</span></span><span style=display:flex><span>             <span style=color:#66d9ef>int</span> h <span style=color:#f92672>=</span> bitmap.<span style=color:#a6e22e>getHeight</span>()
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>         }
</span></span><span style=display:flex><span>     });
</span></span></code></pre></div><h4 id=方式2>方式2： <a href=#%e6%96%b9%e5%bc%8f2 class=anchor>🔗</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>Glide.<span style=color:#a6e22e>with</span>(getContext()).<span style=color:#a6e22e>load</span>(imageUrl).<span style=color:#a6e22e>listener</span>(<span style=color:#66d9ef>new</span> RequestListener<span style=color:#f92672>&lt;</span>String, GlideDrawable<span style=color:#f92672>&gt;</span>() {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>onException</span>(Exception e, String model, Target<span style=color:#f92672>&lt;</span>GlideDrawable<span style=color:#f92672>&gt;</span> target, <span style=color:#66d9ef>boolean</span> isFirstResource) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>onResourceReady</span>(GlideDrawable resource, String model, Target<span style=color:#f92672>&lt;</span>GlideDrawable<span style=color:#f92672>&gt;</span> target, <span style=color:#66d9ef>boolean</span> isFromMemoryCache, <span style=color:#66d9ef>boolean</span> isFirstResource) {
</span></span><span style=display:flex><span>            <span style=color:#75715e>//This returns 0,0</span>
</span></span><span style=display:flex><span>            Log.<span style=color:#a6e22e>e</span>(<span style=color:#e6db74>&#34;TAG&#34;</span>,<span style=color:#e6db74>&#34;_width: &#34;</span> <span style=color:#f92672>+</span> resource.<span style=color:#a6e22e>getBounds</span>().<span style=color:#a6e22e>width</span>() <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; _height:&#34;</span> <span style=color:#f92672>+</span>resource.<span style=color:#a6e22e>getBounds</span>().<span style=color:#a6e22e>height</span>());
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }).<span style=color:#a6e22e>into</span>(ivImage).<span style=color:#a6e22e>getSize</span>(<span style=color:#66d9ef>new</span> SizeReadyCallback() {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onSizeReady</span>(<span style=color:#66d9ef>int</span> width, <span style=color:#66d9ef>int</span> height) {
</span></span><span style=display:flex><span>            <span style=color:#75715e>//This returns size of imageview.</span>
</span></span><span style=display:flex><span>            Log.<span style=color:#a6e22e>e</span>(<span style=color:#e6db74>&#34;TAG&#34;</span>,<span style=color:#e6db74>&#34;width: &#34;</span> <span style=color:#f92672>+</span> width <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; height: &#34;</span> <span style=color:#f92672>+</span> height);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    });
</span></span></code></pre></div><h3 id=宽度适应屏幕高度自适应>宽度适应屏幕，高度自适应 <a href=#%e5%ae%bd%e5%ba%a6%e9%80%82%e5%ba%94%e5%b1%8f%e5%b9%95%e9%ab%98%e5%ba%a6%e8%87%aa%e9%80%82%e5%ba%94 class=anchor>🔗</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>loadPicsFitWidth</span>(Context context, <span style=color:#66d9ef>final</span> String imageUrl, ImageView imageView) {
</span></span><span style=display:flex><span>                ViewGroup.<span style=color:#a6e22e>LayoutParams</span> params <span style=color:#f92672>=</span> imageView.<span style=color:#a6e22e>getLayoutParams</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>//        params.width = ScreenUtils.getScreenWidth(context) - DensityUtil.dp2px(7) * 2;//减去图片两边距,在item_classify_ad.xml的CardView里</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        params.<span style=color:#a6e22e>width</span> <span style=color:#f92672>=</span> ScreenUtils.<span style=color:#a6e22e>getScreenWidth</span>(context) <span style=color:#f92672>-</span> DensityUtil.<span style=color:#a6e22e>dp2px</span>(7) <span style=color:#f92672>*</span> 2;<span style=color:#75715e>//左右边距</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        params.<span style=color:#a6e22e>height</span> <span style=color:#f92672>=</span> 100;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        imageView.<span style=color:#a6e22e>setLayoutParams</span>(params);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Glide.<span style=color:#a6e22e>with</span>(context)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>load</span>(imageUrl)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>apply</span>(RequestOptions.<span style=color:#a6e22e>bitmapTransform</span>(<span style=color:#66d9ef>new</span> RoundedCorners(10)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>listener</span>(<span style=color:#66d9ef>new</span> RequestListener<span style=color:#f92672>&lt;</span>Drawable<span style=color:#f92672>&gt;</span>() {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>onLoadFailed</span>(<span style=color:#a6e22e>@Nullable</span> GlideException e, Object model, Target<span style=color:#f92672>&lt;</span>Drawable<span style=color:#f92672>&gt;</span> target, <span style=color:#66d9ef>boolean</span> isFirstResource) {
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>onResourceReady</span>(Drawable resource, Object model, Target<span style=color:#f92672>&lt;</span>Drawable<span style=color:#f92672>&gt;</span> target, DataSource dataSource, <span style=color:#66d9ef>boolean</span> isFirstResource) {
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>if</span> (imageView <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span>) {
</span></span><span style=display:flex><span>                            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>                        }
</span></span><span style=display:flex><span>                        <span style=color:#75715e>// 首先设置 imageView 的 ScaleType 属性为 ScaleType.FIT_XY，让图片不按比例缩放，把图片塞满整个 View。</span>
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>if</span> (imageView.<span style=color:#a6e22e>getScaleType</span>() <span style=color:#f92672>!=</span> ImageView.<span style=color:#a6e22e>ScaleType</span>.<span style=color:#a6e22e>FIT_XY</span>) {
</span></span><span style=display:flex><span>                            imageView.<span style=color:#a6e22e>setScaleType</span>(ImageView.<span style=color:#a6e22e>ScaleType</span>.<span style=color:#a6e22e>FIT_XY</span>);
</span></span><span style=display:flex><span>                        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                        <span style=color:#75715e>// 得到当前 imageView 的宽度（我设置的是屏幕宽度），获取到 imageView 与图片宽的比例，然后通过这个比例去设置 imageView 的高</span>
</span></span><span style=display:flex><span>                        ViewGroup.<span style=color:#a6e22e>LayoutParams</span> params <span style=color:#f92672>=</span> imageView.<span style=color:#a6e22e>getLayoutParams</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>int</span> vw <span style=color:#f92672>=</span> params.<span style=color:#a6e22e>width</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>float</span> scale <span style=color:#f92672>=</span> (<span style=color:#66d9ef>float</span>) vw <span style=color:#f92672>/</span> (<span style=color:#66d9ef>float</span>) resource.<span style=color:#a6e22e>getIntrinsicWidth</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>int</span> vh <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>round</span>(resource.<span style=color:#a6e22e>getIntrinsicHeight</span>() <span style=color:#f92672>*</span> scale);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                        params.<span style=color:#a6e22e>height</span> <span style=color:#f92672>=</span> vh <span style=color:#f92672>+</span> imageView.<span style=color:#a6e22e>getPaddingTop</span>() <span style=color:#f92672>+</span> imageView.<span style=color:#a6e22e>getPaddingBottom</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                        imageView.<span style=color:#a6e22e>setLayoutParams</span>(params);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                })
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>into</span>(imageView);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><h3 id=监听请求>监听请求 <a href=#%e7%9b%91%e5%90%ac%e8%af%b7%e6%b1%82 class=anchor>🔗</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>Glide.<span style=color:#a6e22e>with</span>(context).<span style=color:#a6e22e>load</span>(url)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>listener</span>(<span style=color:#66d9ef>new</span> RequestListener<span style=color:#f92672>&lt;</span>Drawable<span style=color:#f92672>&gt;</span>() {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>onLoadFailed</span>(<span style=color:#a6e22e>@Nullable</span> GlideException e, Object model, Target<span style=color:#f92672>&lt;</span>Drawable<span style=color:#f92672>&gt;</span> target, <span style=color:#66d9ef>boolean</span> isFirstResource) {
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>onResourceReady</span>(Drawable resource, Object model, Target<span style=color:#f92672>&lt;</span>Drawable<span style=color:#f92672>&gt;</span> target, DataSource dataSource, <span style=color:#66d9ef>boolean</span> isFirstResource) {
</span></span><span style=display:flex><span>                        <span style=color:#75715e>//dosomething</span>
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                })
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>into</span>(imageView);
</span></span></code></pre></div><h3 id=带圆角的图片>带圆角的图片 <a href=#%e5%b8%a6%e5%9c%86%e8%a7%92%e7%9a%84%e5%9b%be%e7%89%87 class=anchor>🔗</a></h3><h4 id=类型1圆形图片>类型1：圆形图片 <a href=#%e7%b1%bb%e5%9e%8b1%e5%9c%86%e5%bd%a2%e5%9b%be%e7%89%87 class=anchor>🔗</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>Glide.<span style=color:#a6e22e>with</span>(<span style=color:#66d9ef>this</span>).<span style=color:#a6e22e>load</span>(imgUrl).<span style=color:#a6e22e>apply</span>(RequestOptions.<span style=color:#a6e22e>bitmapTransform</span>(<span style=color:#66d9ef>new</span> CircleCrop())).<span style=color:#a6e22e>into</span>(image);
</span></span></code></pre></div><h4 id=类型2圆角图片>类型2：圆角图片 <a href=#%e7%b1%bb%e5%9e%8b2%e5%9c%86%e8%a7%92%e5%9b%be%e7%89%87 class=anchor>🔗</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>Glide.<span style=color:#a6e22e>with</span>(<span style=color:#66d9ef>this</span>).<span style=color:#a6e22e>load</span>(imgUrl).<span style=color:#a6e22e>apply</span>(RequestOptions.<span style=color:#a6e22e>bitmapTransform</span>(<span style=color:#66d9ef>new</span> RoundedCorners(20))).<span style=color:#a6e22e>into</span>(image);
</span></span></code></pre></div></div><div class=tags><a href=https://foezzy.github.io/tags/glide>Glide</a></div></section></main><footer id=footer><div class=copyright>© Copyright
2024
<span class=split><svg fill="#bbb" width="15" height="15" id="heart-15" xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 15 15"><path d="M13.91 6.75c-1.17 2.25-4.3 5.31-6.07 6.94-.1903.1718-.4797.1718-.67.0C5.39 12.06 2.26 9 1.09 6.75-1.48 1.8 5-1.5 7.5 3.45 10-1.5 16.48 1.8 13.91 6.75z"/></svg></span></div><div class=powerby>Powered by <a href=http://www.gohugo.io/>Hugo</a> Theme By <a href=https://github.com/nodejh/hugo-theme-mini>nodejh</a></div></footer></body></html>